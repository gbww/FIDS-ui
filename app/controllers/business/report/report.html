<div class="inner-container business-report-list">
  <bread-crumb link-data="vm.breadCrumbArr"></bread-crumb>
  <div class="pt-2">
    <div class="toolbar clearfix">
      <ul class="statusBar clearfix">
        <li ng-class="{'active': vm.status === 5}">
          <a ng-click="vm.searchStatus(5)">
            <i class="icon icon-all-list"></i>
            <span>所有</span>
          </a>
        </li>
        <li ng-class="{'active': vm.status === 0}">
          <a ng-click="vm.searchStatus(0)">
            <i class="fa fa-edit"></i>
            <span>待编制</span>
          </a>
        </li>
        <li ng-class="{'active': vm.status === 1}">
          <a ng-click="vm.searchStatus(1)">
            <i class="icon icon-inspection"></i>
            <span>待审核</span>
          </a>
        </li>
        <li ng-class="{'active': vm.status === 2}">
          <a ng-click="vm.searchStatus(2)">
            <i class="icon icon-approve"></i>
            <span>待批准</span>
          </a>
        </li>
        <li ng-class="{'active': vm.status === 3}">
          <a ng-click="vm.searchStatus(3)">
            <i class="fa fa-print"></i>
            <span>待打印</span>
          </a>
        </li>
        <li ng-class="{'active': vm.status === 4}">
          <a ng-click="vm.searchStatus(4)">
            <i class="icon icon-finished-list"></i>
            <span>完成</span>
          </a>
        </li>
      </ul>

      <div class="switch" ng-click="vm.toggleTable()" ng-if="vm.status === 0 || vm.status === 1 || vm.status === 2">
        <input type="checkbox" ng-checked="vm.showHandled" />
        <label></label>
        <span></span>
      </div>

      <div class="pull-right" ng-show="!vm.advance">
        <input class="input" placeholder="请输入报告编号查询" ng-model="vm.searchConditions.reportId" ng-keyup="vm.eventSearch($event)">
        <button class="btn btn-default-dark" ng-click="vm.search()">
          <i class="fa fa-search"></i>
          <span>查询</span>
        </button>
        <a href class="toggle" ng-click="vm.advance = true">
          <span>展开</span>&nbsp;
          <i class="fa fa-chevron-down"></i>
        </a>
      </div>
      <div class="advanced-search clearfix" ng-show="vm.advance">
        <div class="clearfix">
          <div class="col-sm-3">
            <div custom-select avail-arr="vm.reportIdArr" model="vm.searchConditions" key="reportId" placeholder="报告编号"></div>
          </div>
          <div class="col-sm-3">
            <div custom-select avail-arr="vm.sampleIdArr" model="vm.searchConditions" key="receiveSampleId" placeholder="抽样单编号"></div>
          </div>
          <div class="col-sm-3">
            <div custom-select avail-arr="vm.sampleNameArr" model="vm.searchConditions" key="sampleName" placeholder="样品名称"></div>
          </div>
          <div class="col-sm-3">
            <div custom-select avail-arr="vm.sampleTypeArr" model="vm.searchConditions" key="sampleType" placeholder="样品类别"></div>
          </div>
        </div>
        <div class="clearfix">
          <div class="col-sm-3">
            <div custom-select avail-arr="vm.checkTypeArr" model="vm.searchConditions" key="checkType" placeholder="检验类型"></div>
          </div>
          <div class="col-sm-3">
            <div custom-select avail-arr="vm.entrustedUnitArr" model="vm.searchConditions" key="entrustedUnit" placeholder="委托单位"></div>
          </div>
          <div class="col-sm-3">
            <div custom-select avail-arr="vm.inspectedUnitArr" model="vm.searchConditions" key="inspectedUnit" placeholder="受检单位"></div>
          </div>
          <div class="col-sm-3">
            <div custom-select avail-arr="vm.productionUnitArr" model="vm.searchConditions" key="productionUnit" placeholder="生产单位"></div>
          </div>
        </div>
        <div class="clearfix">
          <div class="col-sm-3">
            <div custom-select avail-arr="vm.exeStandardArr" model="vm.searchConditions" key="executeStandard" placeholder="执行标准"></div>
          </div>
          <div class="col-sm-3">
            <input class="input date" ng-model="vm.searchConditions.startTime" datepicker placeholder="开始时间" />
          </div>
          <div class="col-sm-3">
            <input class="input date" ng-model="vm.searchConditions.endTime" datepicker placeholder="结束时间" />
          </div>
          <button class="btn btn-default-dark" ng-click="vm.search()">
            <i class="fa fa-search"></i>
            <span>查询</span>
          </button>
          <button class="btn btn-default-dark" ng-click="vm.reset()">
            <i class="fa fa-refresh"></i>
            <span>重置</span>
          </button>
          <a href class="toggle" ng-click="vm.back()">
            <span>收起</span>&nbsp;
            <i class="fa fa-chevron-up"></i>
          </a>
        </div>
      </div>
    </div>

    <table class="pt-table" st-table="vm.reports" st-pipe="vm.getReportList">
      <thead st-search-watch="vm.searchObject">
        <tr>
          <th>
            <div st-sort="sampleType">报告编号
              <i class="fa fa-sort"></i>
            </div>
            <adjust-line></adjust-line>
          </th>
          <th>
            <div>样品名称</div>
            <adjust-line></adjust-line>
          </th>
          <th>
            <div>委托单位</div>
            <adjust-line></adjust-line>
          </th>
          <th>
            <div>开始时间</div>
            <adjust-line></adjust-line>
          </th>
          <th>
            <div>结束时间</div>
            <adjust-line></adjust-line>
          </th>
          <th>
            <div st-sort="createdAt">创建时间
              <i class="fa fa-sort"></i>
            </div>
            <adjust-line></adjust-line>
          </th>
          <th>
            <div>状态</div>
            <adjust-line></adjust-line>
          </th>
          <th style="width:100px">操作</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-if="vm.loading">
          <td colspan="8" class="text-center">
            <i class="fa fa-pluse fa-spinner"></i>
          </td>
        </tr>
        <tr ng-if="!vm.loading && vm.reports.length === 0">
          <td colspan="8" class="text-center">暂无报告</td>
        </tr>
        <tr ng-repeat="report in vm.reports track by $index" ng-if="!vm.loading">
          <td>
            <a href ui-sref="app.business.report.inspection({status: vm.status, id: report.receiveSampleId, type: 'ck'})">{{ report.reportId }}</a>
          </td>
          <td>{{ report.sampleName }}</td>
          <td>{{ report.entrustedUnit }}</td>
          <td>{{ report.receiveDate }}</td>
          <td>{{ report.finishDate }}</td>
          <td>{{ report.createdAt | date:'yyyy-MM-dd HH:mm:ss' }}</td>
          <td>
            <i class="icon" ng-class="{'initial icon-status-edit': !report.reportProcessId || report.reportStatus==0,
								'handling icon-status-update': report.reportProcessId && report.reportStatus==1,
								'approving icon-status-distribute': report.reportProcessId && report.reportStatus==2,
								'printing icon-status-doing': report.reportProcessId && report.reportStatus==3,
								'done icon-status-success': report.reportProcessId && report.reportStatus==4}">
            </i>
            <span ng-if="!report.reportProcessId">尚未选择模板</span>
            <span ng-if="report.reportProcessId && report.reportStatus == 0">待编制</span>
            <span ng-if="report.reportProcessId && report.reportStatus == 1">待审核</span>
            <span ng-if="report.reportProcessId && report.reportStatus == 2">待批准</span>
            <span ng-if="report.reportProcessId && report.reportStatus == 3">待打印</span>
            <span ng-if="report.reportProcessId && report.reportStatus == 4">完成</span>
          </td>
          <td class="dropdown-col">
            <div class="btn-group">
              <button class="btn btn-default" ui-sref="app.business.report.detail({status: vm.status, id: report.receiveSampleId, type: 'bj'})">
                <i class="fa fa-edit"></i>
                <sapn>编辑</sapn>
              </button>
              <button class="btn dropdown-toggle" data-toggle="dropdown" ng-if="report.reportProcessId">
                <i class="caret"></i>
              </button>
              <ul class="dropdown-menu">
                <li ui-sref="app.business.report.detail({status: vm.status, id: report.receiveSampleId, type: 'bz', taskId: report.task.id})" ng-if="report.reportProcessId && report.reportStatus == 0 && vm.status === 0">
                  <a href>
                    <i class="fa fa-edit"></i>
                    <span>编制</span>
                  </a>
                </li>
                <li ui-sref="app.business.report.inspection({status: vm.status, id: report.receiveSampleId, type: 'sh', taskId: report.task.id})" ng-if="report.reportProcessId && report.reportStatus == 1 && vm.status === 1">
                  <a href>
                    <i class="icon icon-inspection"></i>
                    <span>审核</span>
                  </a>
                </li>
                <li ui-sref="app.business.report.inspection({status: vm.status, id: report.receiveSampleId, type: 'pz', taskId: report.task.id})" ng-if="report.reportProcessId && report.reportStatus == 2 && vm.status === 2">
                  <a href>
                    <i class="icon icon-approve"></i>
                    <span>批准</span>
                  </a>
                </li>
                <li ng-click="vm.export(report)" ng-if="report.reportProcessId">
                  <a href>
                    <i class="fa fa-file-excel-o"></i>
                    <span>导出</span>
                  </a>
                </li>
                <li ng-click="vm.preview(report)" ng-if="report.reportProcessId">
                  <a href>
                    <i class="fa fa-file-pdf-o"></i>
                    <span>预览</span>
                  </a>
                </li>
              </ul>
            </div>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="8">
            <div st-idp st-total-count="vm.total"></div>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>
