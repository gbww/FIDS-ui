<div class="inner-container business-report-detail-list">
  <bread-crumb link-data="vm.breadCrumbArr"></bread-crumb>
  <div class="pt-2">
    <div class="loading" ng-show="vm.loading">
      <i></i>
    </div>
    <form name="form" novalidate ng-show="!vm.loading">
      <div class="toggle-header" ng-click="vm.showReport = !vm.showReport">
        <i class="fa" ng-class="{'fa-caret-up': vm.showReport, 'fa-caret-down': !vm.showReport}"></i>
        <span>报告内容</span>
      </div>
      <div class="toggle-body" ng-show="vm.showReport">
        <table class="form-table">
          <tr>
            <td class="item-title">报告编号</td>
            <td>{{ vm.report.reportId }}</td>
            <td class="item-title">抽样单编号</td>
            <td>{{ vm.report.receiveSampleId }}</td>
          </tr>
          <tr>
            <td class="item-title">协议编号</td>
            <td>{{ vm.report.protocolId }}</td>
            <td class="item-title">检验类型</td>
            <td>{{ vm.report.checkType}}</td>
          </tr>
          <tr>
            <td class="item-title">抽样环节</td>
            <td>{{ vm.report.sampleLink }}</td>
            <td class="item-title">样品类别</td>
            <td>{{ vm.report.sampleType }}</td>
          </tr>
          <tr ng-show="vm.report.sampleType === '食品'">
            <td class="item-title">食品大类</td>
            <td>{{ vm.report.foodDalei }}</td>
            <td class="item-title">食品亚类</td>
            <td>{{ vm.report.foodYalei }}</td>
          </tr>
          <tr ng-show="vm.report.sampleType === '食品'">
            <td class="item-title">食品次亚类</td>
            <td>{{ vm.report.foodCiyalei }}</td>
            <td class="item-title">食品细类</td>
            <td>{{ vm.report.foodXilei }}</td>
          </tr>
          <tr>
            <td class="item-title">报告模板</td>
            <td>{{ vm.template }}</td>
            <td class="item-title"></td>
            <td></td>
          </tr>
        </table>

        <table class="form-table">
          <tr>
            <td class="item-title">委托单位/人</td>
            <td>{{ vm.report.entrustedUnit }}</td>
            <td class="item-title">委托单位地址</td>
            <td>{{ vm.report.entrustedUnitAddress }}</td>
          </tr>
          <tr>
            <td class="item-title">电话</td>
            <td>{{ vm.report.entrustedUserPhone }}</td>
            <td class="item-title"></td>
            <td></td>
          </tr>
          <tr>
            <td class="item-title">受检单位</td>
            <td>{{ vm.report.inspectedUnit }}</td>
            <td class="item-title">受检单位地址</td>
            <td>{{ vm.report.inspectedUnitAddress }}</td>
          </tr>
          <tr>
            <td class="item-title">联系人</td>
            <td>{{ vm.report.inspectedUser }}</td>
            <td class="item-title">电话</td>
            <td>{{ vm.report.inspectedUserPhone }}</td>
          </tr>
        </table>

        <table class="form-table">
          <tr>
            <td class="item-title">样品名称</td>
            <td>{{ vm.report.sampleName }}</td>
            <td class="item-title">样品管理类别</td>
            <td>{{ vm.sampleManager.managerType }}</td>
          </tr>
          <tr>
            <td class="item-title">样品流通方式</td>
            <td>{{ vm.report.sampleCirculate }}</td>
            <td class="item-title">样品流通日期</td>
            <td>{{ vm.report.sampleCirculateDate }}</td>
          </tr>

          <tr>
            <td class="item-title">接收样品日期</td>
            <td>{{ vm.report.receiveDate }}</td>
            <td class="item-title">样品质保日期（天）</td>
            <td>{{ vm.report.zhibaoqi }}</td>
          </tr>
          <tr>
            <td class="item-title">样品数量</td>
            <td>{{ vm.report.sampleNumber }}</td>
            <td class="item-title">留样数量</td>
            <td>{{ vm.report.liuyangCount }}</td>
          </tr>
          <tr>
            <td class="item-title">样品类型</td>
            <td>{{ vm.report.sampleLeixing }}</td>
            <td class="item-title">样品状态</td>
            <td>{{ vm.report.sampleStatus }}</td>
          </tr>
          <tr>
            <td class="item-title">规格型号</td>
            <td>{{ vm.report.specificationModel }}</td>
            <td class="item-title">包装分类</td>
            <td>{{ vm.report.packageClassify }}</td>
          </tr>
          <tr>
            <td class="item-title">保存条件</td>
            <td>{{ vm.report.saveWay }}</td>
            <td class="item-title">生产许可证</td>
            <td>{{ vm.report.licence }}</td>
          </tr>
          <tr>
            <td class="item-title">等级或加工工艺</td>
            <td>{{ vm.report.processingTechnology }}</td>
            <td class="item-title">封样状态</td>
            <td>{{ vm.report.closedStatus }}</td>
          </tr>
          <tr>
            <td class="item-title">商标</td>
            <td>{{ vm.report.sampleTrademark }}</td>
            <td class="item-title">样品废弃状态</td>
            <td>{{ vm.sampleManager.status }}</td>
          </tr>
          <tr>
            <td class="item-title">生产单位</td>
            <td>{{ vm.report.productionUnit }}</td>
            <td class="item-title">生产单位地址</td>
            <td>{{ vm.report.productionAddress }}</td>
          </tr>
          <tr>
            <td class="item-title">联系人</td>
            <td>{{ vm.report.productionUser }}</td>
            <td class="item-title">电话</td>
            <td>{{ vm.report.productionPhone }}</td>
          </tr>
        </table>

        <table class="form-table">
          <tr>
            <td class="item-title">执行标准</td>
            <td>{{ vm.report.executeStandard }}</td>
            <td class="item-title">报告签发日期</td>
            <td>{{ vm.report.qianfaDate }}</td>
          </tr>
          <tr>
            <td class="item-title">抽样地点</td>
            <td>{{ vm.report.sampleAddress }}</td>
            <td class="item-title">抽样方式</td>
            <td>{{ vm.report.sampleWay }}</td>
          </tr>
          <tr>
            <td class="item-title">接样基数</td>
            <td>{{ vm.report.sampleBasenumber }}</td>
            <td class="item-title">抽样时间</td>
            <td>{{ vm.report.sampleDate }}</td>
          </tr>
          <tr>
            <td class="item-title">抽样人或单位</td>
            <td>{{ vm.report.sampleNames }}</td>
            <td class="item-title">业务负责人</td>
            <td>{{ vm.report.responsiblePerson }}</td>
          </tr>
          <tr>
            <td class="item-title">交样人</td>
            <td>{{ vm.report.sampleHolder }}</td>
            <td class="item-title">收样人</td>
            <td>{{ vm.report.receiveUser }}</td>
          </tr>
          <tr>
            <td class="item-title">约定完成日期</td>
            <td>{{ vm.report.arrangeFinishDate }}</td>
            <td class="item-title">要求完成日期</td>
            <td>{{ vm.report.finishDate }}</td>
          </tr>
        </table>

        <table class="form-table">
          <tr>
            <td class="item-title">费用</td>
            <td>{{ vm.report.cost }}</td>
            <td class="item-title">附件</td>
            <td>
              <div class="file-item" ng-click="vm.downloadFile(vm.report.appendix)" ng-if="vm.report.appendix">
                <span>{{ vm.report.appendix.substring(vm.report.appendix.lastIndexOf('/')+1) }}</span>
              </div>
            </td>
          </tr>
          <tr>
            <td class="item-title">判定</td>
            <td>{{ vm.report.determine }}</td>
            <td class="item-title"></td>
            <td></td>
          </tr>
          <tr>
            <td class="item-title">结论</td>
            <td colspan="3">{{ vm.report.result }}</td>
          </tr>
          <tr>
            <td class="item-title">备注</td>
            <td colspan="3">{{ vm.report.remarks }}</td>
          </tr>
          <tr>
            <td class="item-title">数据页备注</td>
            <td colspan="3"><pre>{{ vm.report.dataRemarks }}</pre></td>
          </tr>
          <tr>
            <td class="item-title">主检人</td>
            <td>{{ vm.report.principalInspector }}</td>
            <td class="item-title">编制人</td>
            <td>{{ vm.report.drawUser }}</td>
          </tr>
          <tr ng-if="vm.type === 'ck' || vm.type === 'pz'">
            <td class="item-title">审核人</td>
            <td>{{ vm.report.examineUser }}</td>
            <td class="item-title">批准人</td>
            <td>{{ vm.report.approvalUser }}</td>
          </tr>

          <tbody>
            <tr>
              <td class="item-title">
                <span>编制/审核/批准意见</span>
              </td>
              <td colspan="3"><pre>{{ vm.comments }}</pre></td>
            </tr>
            <!-- <tr ng-show="vm.report.reportStatus > 1">
              <td class="item-title">
                <span>审核意见</span>
              </td>
              <td colspan="3">{{ vm.shComment }}</td>
            </tr>
            <tr ng-show="vm.report.reportStatus > 2">
              <td class="item-title">
                <span>批准意见</span>
              </td>
              <td colspan="3">{{ vm.pzComment }}</td>
            </tr> -->
          </tbody>

          <tbody ng-show="vm.type === 'sh'">
            <tr>
              <td class="item-title">
                <span class="item-required">是否同意</span>
              </td>
              <td>
                <input type="radio" id="yes" ng-model="vm.pass" value="true">
                <label for="yes">同意</label>&emsp;&emsp;&emsp;
                <input type="radio" id="no" ng-model="vm.pass" value="false">
                <label for="no">不同意</label>
              </td>
              <td class="item-title">
                <span ng-class="{'item-required': vm.pass === 'true'}">批准人</span>
              </td>
              <td>
                <select class="input" name="approvalUser" ng-model="vm.report.approvalUser" ng-options="option.name as option.name for option in vm.users" ng-required="vm.pass === 'true'"></select>
                <div ng-if="form.approvalUser.$dirty || vm.submitted" ng-messages="form.approvalUser.$error">
                  <label class="error-messages" ng-message="required">
                    <i></i>不能为空</label>
                </div>
              </td>
            </tr>
            <tr>
              <td class="item-title">
                <span>意见</span>
              </td>
              <td colspan="3">
                <textarea class="input" rows="2" ng-model="vm.comment"></textarea>
              </td>
            </tr>
          </tbody>

          <tbody ng-show="vm.type === 'pz'">
            <tr>
              <td class="item-title">
                <span class="item-required">是否同意</span>
              </td>
              <td>
                <input type="radio" id="yes" ng-model="vm.pass" value="true">
                <label for="yes">同意</label>&emsp;&emsp;&emsp;
                <input type="radio" id="no" ng-model="vm.pass" value="false">
                <label for="no">不同意</label>
              </td>
              <td class="item-title"></td>
              <td></td>
            </tr>
            <tr>
              <td class="item-title">
                <span>意见</span>
              </td>
              <td colspan="3">
                <textarea class="input" rows="2" ng-model="vm.comment"></textarea>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="toggle-header" ng-click="vm.showReportCi = !vm.showReportCi">
        <i class="fa" ng-class="{'fa-caret-up': vm.showReportCi, 'fa-caret-down': !vm.showReportCi}"></i>
        <span>报告检测项</span>
      </div>
      <div class="toggle-body" ng-show="vm.showReportCi">
        <table class="pt-table narrow-table">
          <thead>
            <tr>
              <th>
                <div>名称</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>检测方法</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>单位</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>标准值</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>检出限</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>定量限</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>设备</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>默认价格</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>状态</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>结果</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>实测值</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>分包</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>检测部门</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>检测员</div>
                <adjust-line></adjust-line>
              </th>
              <th>
                <div>更新时间</div>
                <adjust-line></adjust-line>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr ng-if="vm.checkItems.length==0 ">
              <td colspan="15 " class="text-center ">暂无检测项</td>
            </tr>
            <tr ng-repeat="item in vm.checkItems track by item.id">
              <td>{{ item.name }}</td>
              <td>{{ item.method }}</td>
              <td>{{ item.unit }}</td>
              <td>{{ item.standardValue }}</td>
              <td>{{ item.detectionLimit }}</td>
              <td>{{ item.quantitationLimit }}</td>
              <td>{{ item.device }}</td>
              <td>{{ item.defaultPrice }}</td>
              <td>
                <span ng-if="item.status==0 ">未录入</span>
                <span ng-if="item.status==1 ">待检测</span>
                <span ng-if="item.status==2 ">检测完成</span>
              </td>
              <td>{{ item.itemResult }}</td>
              <td>{{ item.measuredValue }}</td>
              <td>{{ item.subpackage }}</td>
              <td>{{ item.testRoom }}</td>
              <td>{{ item.testUser }}</td>
              <td>{{ item.updatedAt | date:'yyyy-MM-dd hh:mm:ss' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </form>
    <div class="btn-area text-center" ng-show="!vm.loading && (vm.type === 'sh' || vm.type === 'pz')">
      <button class="btn btn-2x btn-default-dark" ng-click="vm.ok(form)">确认</button>
      <button class="btn b5n-2x btn-default-light" ui-sref="app.business.report({status: vm.status})">取消</button>
    </div>
  </div>
</div>
