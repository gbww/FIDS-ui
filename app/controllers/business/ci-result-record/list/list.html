<div class="business-report-list">
  <div class="toolbar clearfix">
    <button class="btn btn-default-dark" ui-sref="app.business.itemToCheck.sample" ng-if="vm.isSampleDetail">
      <i class="fa fa-reply"></i>
      <span>返回上一级</span>
    </button>

    <button class="btn btn-default-dark" ng-click="vm.batch()" role-auth="SAMPLE-UPDATEITEMRESULT-1">
      <i class="fa fa-edit"></i>
      <span>批量录入</span>
    </button>

    <ul class="statusBar clearfix">
      <li ng-class="{'active': vm.status === 1}">
        <a ng-click="vm.searchStatus(1)">
          <i class="icon icon-todo-list"></i>
          <span>待办</span>
        </a>
      </li>
      <li ng-class="{'active': vm.status === 2}">
        <a ng-click="vm.searchStatus(2)">
          <i class="icon icon-finished-list"></i>
          <span>已办</span>
        </a>
      </li>
      <li ng-class="{'active': vm.status === 5}">
        <a ng-click="vm.searchStatus(5)">
          <i class="icon icon-all-list"></i>
          <span>所有</span>
        </a>
      </li>
    </ul>

    <div class="pull-right" ng-show="!vm.advance">
      <input class="input" placeholder="请输入报告编号查询" ng-model="vm.query.reportId" ng-keyup="vm.eventSearch($event)">
      <button class="btn btn-default-dark" ng-click="vm.search()">
        <i class="fa fa-search"></i>
        <span>查询</span>
      </button>
      <a href class="toggle" ng-click="vm.advance = true">
        <span>展开</span>&nbsp;
        <i class="fa fa-chevron-down"></i>
      </a>
    </div>
    <div class="advanced-search clearfix" ng-show="vm.advance">
      <div class="clearfix">
        <div class="col-sm-3">
          <input class="input" placeholder="请输入报告编号" ng-model="vm.query.reportId">
        </div>
        <div class="col-sm-3">
          <input class="input" placeholder="请输入抽样单编号" ng-model="vm.query.receiveSampleId">
        </div>
        <div class="col-sm-3">
          <input class="input" placeholder="请输入检测项名称" ng-model="vm.query.name">
        </div>
        <button class="btn btn-default-dark" ng-click="vm.search()">
          <i class="fa fa-search"></i>
          <span>查询</span>
        </button>
        <button class="btn btn-default-dark" ng-click="vm.reset()">
          <i class="fa fa-refresh"></i>
          <span>重置</span>
        </button>
        <a href class="toggle" ng-click="vm.back()">
          <span>收起</span>&nbsp;
          <i class="fa fa-chevron-up"></i>
        </a>
      </div>
      <div class="clearfix">
        <div class="col-sm-3">
          <input class="input" placeholder="请输入检测方法" ng-model="vm.query.method">
        </div>
      </div>
    </div>
  </div>
  <table class="pt-table" st-table="vm.checkItems" st-pipe="vm.getCheckItemList">
    <thead st-search-watch="vm.searchObject">
      <tr>
        <th style="width: 24px;">
          <input type="checkbox" ng-click="vm.selectAll()" ng-model="vm.allSelected">
        </th>
        <th style="width: 100px">
          <div st-sort="reportId">报告编号
            <i class="fa fa-sort"></i>
          </div>
          <adjust-line></adjust-line>
        </th>
        <th style="width: 100px">
          <div st-sort="receiveSampleId">抽样单编号
            <i class="fa fa-sort"></i>
          </div>
          <adjust-line></adjust-line>
        </th>
        <th>
          <div>样品名称</div>
          <adjust-line></adjust-line>
        </th>
        <th>
          <div>检测项名称</div>
          <adjust-line></adjust-line>
        </th>
        <th style="width: 80px;">
          <div st-sort="method">检测方法
            <i class="fa fa-sort"></i>
          </div>
          <adjust-line></adjust-line>
        </th>
        <th>
          <div>单位</div>
          <adjust-line></adjust-line>
        </th>
        <th>
          <div>标准值</div>
          <adjust-line></adjust-line>
        </th>
        <th>
          <div>检出限</div>
          <adjust-line></adjust-line>
        </th>
        <th>
          <div>定量限</div>
          <adjust-line></adjust-line>
        </th>
        <th>
          <div>设备</div>
          <adjust-line></adjust-line>
        </th>
        <th style="width: 90px;">
          <div>状态</div>
          <adjust-line></adjust-line>
        </th>
        <th>
          <div>结果</div>
          <adjust-line></adjust-line>
        </th>
        <th>
          <div>实测值</div>
          <adjust-line></adjust-line>
        </th>
        <th style="width: 80px;">
          <div st-sort="testRoom">检测部门
            <i class="fa fa-sort"></i>
          </div>
          <adjust-line></adjust-line>
        </th>
        <th style="width: 80px;">
          <div st-sort="testUser">检测员
            <i class="fa fa-sort"></i>
          </div>
          <adjust-line></adjust-line>
        </th>
        <th>
          <div st-sort="updatedAt">更新时间
            <i class="fa fa-sort"></i>
          </div>
          <adjust-line></adjust-line>
        </th>
        <th style="width: 100px">
          <div>操作</div>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr ng-if="vm.loading">
        <td colspan="18" class="text-center">
          <i class="fa fa-pulse fa-spinner"></i>
        </td>
      </tr>
      <tr ng-if="!vm.loading && vm.checkItems.length == 0">
        <td colspan="18" class="text-center">暂无检测项</td>
      </tr>
      <tr ng-repeat="item in vm.checkItems track by item.id" ng-if="!vm.loading">
        <td>
          <input type="checkbox" ng-checked="vm.itemSelected[$index]" ng-click="vm.selectItem($event, $index, item)">
        </td>
        <td>
          <a ui-sref="app.business.itemToCheck.detail({status: vm.status, id: item.reportId})">{{ item.reportId }}</a>
        </td>
        <td>{{ item.receiveSampleId }}</td>
        <td>{{ item.sample.sampleName }}</td>
        <td>{{ item.name }}</td>
        <td>{{ item.method }}</td>
        <td>{{ item.unit }}</td>
        <td>{{ item.standardValue }}</td>
        <td>{{ item.detectionLimit }}</td>
        <td>{{ item.quantitationLimit }}</td>
        <td>{{ item.device }}</td>
        <td>
          <i class="icon" ng-class="{'initial icon-status-unhandle': item.status==1,
								'done icon-status-success': item.status==2}">
          </i>
          <span ng-if="item.status == 1">待检测</span>
          <span ng-if="item.status == 2">检测完成</span>
        </td>
        <td>
          <i class="icon" ng-class="{'initial icon-status-doing': item.itemResult !== '合格'&&item.itemResult !== '不合格',
								'done icon-status-success': item.itemResult === '合格',
								'failed icon-status-failed': item.itemResult === '不合格'}" ng-if="item.itemResult">
          </i>
          <span ng-class="{'failed': item.itemResult === '不合格'}">{{ item.itemResult }}</span>
        </td>
        <td>{{ item.measuredValue }}</td>
        <td>{{ item.testRoom }}</td>
        <td>{{ item.testUser }}</td>
        <td>{{ item.updatedAt | date:'yyyy-MM-dd hh:mm:ss' }}</td>
        <td class="dropdown-col" ng-if="item.status == 1">
          <div class="btn-group" role-auth="SAMPLE-UPDATEITEMRESULT-1">
            <button class="btn btn-default" ng-click="vm.recordResult(item)" role-auth="SAMPLE-UPDATEITEMRESULT-1">
              <i class="fa fa-edit"></i>
              <span>录入</span>
            </button>
            <button class="btn btn-default" ng-click="vm.distribute(item)" role-auth="SAMPLE-DISTRIBUTE-SELECT-1" ng-if="!vm.hasRecordAuth">
              <i class="icon icon-distribute"></i>
              <span>重新分配</span>
            </button>
            <button class="btn dropdown-toggle" data-toggle="dropdown" role-auth="SAMPLE-DISTRIBUTE-SELECT-1">
              <i class="caret"></i>
            </button>
            <ul class="dropdown-menu">
              <li ng-click="vm.distribute(item)">
                <a href>
                  <i class="icon icon-distribute"></i>
                  <span>重新分配</span>
                </a>
              </li>
            </ul>
          </div>
        </td>
        <td ng-if="item.status == 2">
          <button class="btn btn-default" ng-click="vm.recordResult(item)" role-auth="SAMPLE-UPDATEITEMRESULT-1">
            <i class="fa fa-edit"></i>
            <span>录入</span>
          </button>
        </td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="18">
          <div st-idp st-total-count="vm.total"></div>
        </td>
      </tr>
    </tfoot>
  </table>

  <div class="modal fade" id="batchRecordModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button class="close" ng-click="vm.close()">&times;</button>
          <h4>批量录入检测结果</h4>
        </div>
        <div class="modal-body">
          <table class="pt-table editable-table">
            <thead>
              <tr>
                <th style="width: 100px">
                  <div>报告编号</div>
                  <adjust-line></adjust-line>
                </th>
                <th style="width: 100px">
                  <div>抽样单编号</div>
                  <adjust-line></adjust-line>
                </th>
                <th>
                  <div>名称</div>
                  <adjust-line></adjust-line>
                </th>
                <th style="width: 80px;">
                  <div>检测方法</div>
                  <adjust-line></adjust-line>
                </th>
                <th>
                  <div>单位</div>
                  <adjust-line></adjust-line>
                </th>
                <th>
                  <div>标准值</div>
                  <adjust-line></adjust-line>
                </th>
                <th>
                  <div>检出限</div>
                  <adjust-line></adjust-line>
                </th>
                <th>
                  <div>定量限</div>
                  <adjust-line></adjust-line>
                </th>
                <th>
                  <div>设备</div>
                  <adjust-line></adjust-line>
                </th>
                <th style="width: 90px;">
                  <div>状态</div>
                  <adjust-line></adjust-line>
                </th>
                <th>
                  <div>结果</div>
                  <adjust-line></adjust-line>
                </th>
                <th>
                  <div>实测值</div>
                  <adjust-line></adjust-line>
                </th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="item in vm.selectedItemsCopy track by item.id" ng-class="{'selected': vm.selectedRow === $index}">
                <td>{{ item.reportId }}</td>
                <td>{{ item.receiveSampleId }}</td>
                <td>
                  <input ng-model="item.name" />
                </td>
                <td>
                  <input ng-model="item.method" />
                </td>
                <td>
                  <div custom-select class-name="inline" avail-arr="vm.characterArr" model="item" key="unit"></div>
                </td>
                <td>
                  <div custom-select mode="append" class-name="inline" avail-arr="vm.characterArr" model="item" key="standardValue"></div>
                </td>
                <td>
                  <input ng-model="item.detectionLimit" />
                </td>
                <td>
                  <input ng-model="item.quantitationLimit" />
                </td>
                <td>
                  <input ng-model="item.device" />
                </td>
                <td>
                  <i class="icon" ng-class="{'initial icon-status-unhandle': item.status==1,
                                  'done icon-status-success': item.status==2}">
                  </i>
                  <span ng-if="item.status == 1">待检测</span>
                  <span ng-if="item.status == 2">检测完成</span>
                </td>
                <td>
                  <div custom-select avail-arr="vm.resultArr" model="item" key="itemResult"></div>
                </td>
                <td>
                  <input ng-model="item.measuredValue" />
                </td>
                <td>
                  <a href ng-click="vm.patch(item, $index)">填充</a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-2x btn-default-dark" ng-click="vm.batchOk()">确认</button>
          <button class="btn btn-2x btn-default-light" ng-click="vm.batchClose()">取消</button>
        </div>
      </div>
    </div>
  </div>

</div>